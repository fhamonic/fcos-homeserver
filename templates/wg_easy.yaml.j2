variant: fcos
version: 1.6.0
passwd:
  groups:
    - name: g_wg-easy
      gid: {{ 1000 + id }}
  users:
    - name: u_wg-easy
      uid: {{ 1000 + id }}
      groups: [g_wg-easy]
storage:
  directories:
    - path: /var/wg-easy
      mode: 0744
      user: { name: u_wg-easy }
      group: { name: g_wg-easy }
  files:
    # ############################ Kernel modules #############################
    - path: /etc/modules-load.d/wg-easy.conf
      contents:
        inline: |
          wireguard
          nft_masq
    # ############################### Container ###############################
    - path: /etc/containers/systemd/wg-easy.container
      contents:
        inline: |
          [Unit]
          Description=AdGuardHome
          Wants=network-online.target
          After=network-online.target

          [Container]
          ContainerName=wg-easy
          Image={{ wg_easy.image }}
          AutoUpdate=registry
          Network=host

          Volume=/var/wg-easy:/etc/wireguard:Z

          AddCapability=NET_ADMIN
          AddCapability=SYS_MODULE
          AddCapability=NET_RAW
          Sysctl=net.ipv4.ip_forward=1
          Sysctl=net.ipv4.conf.all.src_valid_mark=1
          Sysctl=net.ipv6.conf.all.disable_ipv6=0
          Sysctl=net.ipv6.conf.all.forwarding=1
          Sysctl=net.ipv6.conf.default.forwarding=1

          [Install]
          WantedBy=default.target


