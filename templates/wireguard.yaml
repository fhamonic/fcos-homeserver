variant: fcos
version: 1.6.0
# https://docs.fedoraproject.org/en-US/fedora-coreos/sysconfig-configure-wireguard/
storage:
  files:
    - path: /etc/sysctl.d/90-ipv4-ip-forward.conf
      mode: 0644
      contents:
        inline: |
          net.ipv4.ip_forward = 1
    - path: /etc/wireguard/wg0.conf
      mode: 0600
      contents:
        inline: |
          [Interface]
          Address = 10.0.0.1/24
          ListenPort = 51820
          PrivateKey = IKXdQmKN+qsOyr/sTpH8ZsqCLETDwKwZQpmnX2xf+lc=
          PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o enp2s0f1 -j MASQUERADE
          PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o enp2s0f1 -j MASQUERADE

          [Peer]
          PublicKey = hL81CT+QCgAT7sE/88yufkWNY3EnF6VlxG7VEPapyRY=
          PresharedKey = CvX7UPUXwDSso2Za9rBqhDtugo5P3ux6XDfIBfJx/gg=
          AllowedIPs = 10.0.0.2/32
systemd:
  units:
    - name: wg-quick@wg0.service
      enabled: true